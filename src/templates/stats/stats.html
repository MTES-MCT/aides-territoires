{% extends '_base.html' %}
{% load i18n %}

{% block extratitle %}{{ _('Public stats') }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@2.8.0/dist/Chart.min.css" />
{% endblock %}

{% block content %}
<section id="stats">

    <div class="stat">
        <span class="stat-title">
            {{ _('Available aids') }}<br />
            <small>{% blocktrans trimmed %}
                Published aids that are still open.
            {% endblocktrans %}</small>
        </span>
        <div class="stat-body number-stat">
            <span>{{ nb_live_aids }}</span>
        </div>
    </div>

    <div class="stat">
        <span class="stat-title">
            {{ _('Sent alerts') }}<br />
            <small>{% blocktrans trimmed %}
                Emails sent with new alerts notification
            {% endblocktrans %}
            </small>
        </span>
        <div class="stat-body number-stat">
            <span>{{ nb_sent_alerts }}</span>
        </div>
    </div>

    <div class="stat">
        <span class="stat-title">
            {{ _('Recently viewed aids') }}<br />
            <small>{% blocktrans trimmed %}
                Aids viewed within the last 7 days
            {% endblocktrans %}</small>

        </span>
        <div class="stat-body number-stat">
            <span>{{ nb_viewed_aids_1_week }}</span>
        </div>
    </div>

    <div class="stat">
        <span class="stat-title">
            {{ _('Aid backers') }}<br />
            <small>{% blocktrans trimmed %}
                Organizations that are financing or instructing aids
            {% endblocktrans %}</small>

        </span>
        <div class="stat-body number-stat">
            <span>{{ nb_backers }}</span>
        </div>
    </div>

    <hr />

    <div class="stat">
        <span class="stat-title">
            {{ _('Viewed aids') }}
        </span>
        <div style="min-height: 400px">
            <canvas id="chartAidsViewed" style="width: 80%;"></canvas>
        </div>
    </div>

    <hr />

    <div class="stat">
        <span class="stat-title">
            Alertes crées
        </span>
        <div style="min-height: 400px">
            <canvas id="chartAlertsCreated" style="width: 80%;"></canvas>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0/dist/Chart.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
      const ctx = document.getElementById('chartAidsViewed').getContext('2d');
    
      // Sample data
      const chartData = {{ nb_viewed_aids_timeseries | safe }};
    
      // Parse the dates to JS
      chartData.forEach((d) => {
        d.x = new Date(d.day);
      });
    
      // Render the chart
      const chart = new Chart(ctx, {
        type: 'bar',
        data: {
          datasets: [
            {
              label: "{{ _('Viewed aids') }}",
              data: chartData,
              backgroundColor: '#DB1C83',
            },
          ],
        },
        options: {
          responsive: true,
          scales: {
            xAxes: [
              {
                type: 'time',
                time: {
                  unit: 'month',
                  isoWeekday: true
                },
                gridLines: {
                    display: false
                },
                offset: true
              },
            ],
            yAxes: [
              {
                ticks: {
                  beginAtZero: true,
                  precision: 0
                },
              },
            ],
          },
        },
      });
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
      const ctx = document.getElementById('chartAlertsCreated').getContext('2d');
    
      // Sample data
      const chartData = {{ nb_alerts_created_timeseries | safe }};
    
      // Parse the dates to JS
      chartData.forEach((d) => {
        d.x = new Date(d.day);
      });
    
      // Render the chart
      const chart = new Chart(ctx, {
        type: 'bar',
        data: {
          datasets: [
            {
              label: "Alertes crées",
              data: chartData,
              backgroundColor: '#DB1C83',
            },
          ],
        },
        options: {
          responsive: true,
          scales: {
            xAxes: [
              {
                type: 'time',
                time: {
                  unit: 'month',
                  isoWeekday: true
                },
                gridLines: {
                    display: false
                },
                offset: true
              },
            ],
            yAxes: [
              {
                ticks: {
                  beginAtZero: true,
                  precision: 0
                },
              },
            ],
          },
        },
      });
    });
</script>
{% endblock %}