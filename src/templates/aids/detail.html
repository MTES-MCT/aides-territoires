{% extends '_base.html' %}
{% load i18n aids %}

{% block extratitle %}{{ aid.name }}{% endblock %}

{% block breadcrumbs %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li><a href="{% url 'home' %}">{{ _('Home') }}</a></li>
        <li><a href="{% url 'search_view' %}">{{ _('All aids') }}</a></li>
        <li class="active" aria-current="page">{{ _('Aid detail') }}</li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<section id="aid">

    <h1>
        {{ aid.name }}
        <br /><small>{{ aid.backers.all|join:', ' }}</small>
    </h1>

    <div class="aid-actions">
        <button class="bookmark"
            data-toggle="modal"
            data-target="#bookmark-modal">
            {{ _('Bookmark this aid') }}
        </button>

        <button class="report-error"
            data-toggle="modal"
            data-target="#error-report-modal">
            {{ _('Report a problem') }}
        </button>
    </div>

    <h2>{{ _('Description') }}</h2>
    <p>
        {% if aid.description %}
            {{ aid.description|safe }}
        {% else %}
            {{ _('No detailed description was submitted.') }}
        {% endif %}
    </p>

    {% if aid.tags %}
    <p>
        <i class="fas fa-tags"></i>
        {{ _('Keywords:') }}
        {{ aid.tags|join:', ' }}
    </p>
    {% endif %}

    <div class="row">
        <div class="column">
            <h2>{{ _('Who can apply to this aid?') }}</h2>
            <p>{% choices_display aid 'targeted_audiances' %}</p>
        </div>

        <div class="column">
            <h2>{{ _('Application perimeter') }}</h2>
            <p>{{ aid.perimeter }}</p>
        </div>
    </div>

    <div class="row">
        <div class="column">
            <h2>{{ _('Recurrence') }}</h2>
            <p>{{ aid.get_recurrence_display|default:_('ND') }}</p>
        </div>
        <div class="column">
            <h2>{{ _('Start date') }}</h2>
            <p>{{ aid.start_date|date|default:_('ND') }}</p>
        </div>
    </div>

    <div class="row">
        <div class="column">
            <h2>{{ _('Predeposit date') }}</h2>
            <p>{{ aid.predeposit_date|date|default:_('ND') }}</p>
        </div>
        <div class="column">
            <h2>{{ _('Submission deadline') }}</h2>
            <p>{{ aid.submission_deadline|date|default:_('ND') }}</p>
        </div>
    </div>

    <div class="row">
        <div class="column">
            <h2>{{ _('Aid type') }}</h2>
            <p>{% choices_display aid 'aid_types' %}</p>
        </div>
        <div class="column">
            <h2>{{ _('Subvention rate') }}</h2>
            <p>{{ aid.subvention_rate|default:_('ND') }}</p>
        </div>
    </div>

    <div class="row">
        <div class="column">
            <h2>{{ _('When to mobilize the aid?') }}</h2>
            <p>{% choices_display aid 'mobilization_steps' %}</p>
        </div>
        <div class="column">
            <h2>{{ _('The aid is destined toâ€¦') }}</h2>
            <p>{% choices_display aid 'destinations' %}</p>
        </div>
    </div>


    <h2>{{ _('Other eligibility criterias') }}</h2>
    <p>{{ aid.eligibility|safe }}</p>


    <h2>{{ _('Link to full description') }}</h2>
    <p>
        {% if aid.url %}
        <a href="{{ aid.url }}">{{ aid.url }}</a>
        {% else %}
            {{ _('ND') }}
        {% endif %}
    </p>

    <h2>{{ _('Link to an online application form') }}</h2>
    <p>
        {% if aid.application_url %}
            <a href="{{ aid.application_url }}">{{ aid.application_url }}</a>
        {% else %}
            {{ _('ND') }}
        {% endif %}
    </p>

    <div class="row">
        <div class="column">
            <h2>{{ _('Contact (name)') }}</h2>
            <p>{{ aid.contact_detail|default:_('ND') }}</p>
        </div>
        <div class="column">
            <h2>{{ _('Contact (email)') }}</h2>
            <p>{{ aid.contact_email|default:_('ND') }}</p>
        </div>
        <div class="column">
            <h2>{{ _('Contact (phone)') }}</h2>
            <p>{{ aid.contact_phone|default:_('ND') }}</p>
        </div>
    </div>

    {% if similar_aids %}
    <h2>{{ _('Similar aids') }}</h2>
    <p>{% blocktrans trimmed %}
    Those aids present some similarities and might be worth checking.
    {% endblocktrans %}</p>
    <ul>
        {% for aid in similar_aids %}
            <li><a href="{{ aid.get_absolute_url }}">{{ aid }}</a></li>
        {% endfor %}
    </ul>
    {% endif %}
</section>
{% endblock %}

{% block footer %}
{{ block.super }}
{% include 'aids/_problem_report_modal.html' %}
{% include 'aids/_bookmark_modal.html' %}
{% endblock %}

{% block extra_js %}
<script>
    // Translations strings
    var catalog = {
        bookmark_waiting: '{{ _("Please stand by.") }}',
        bookmark_success: '{% trans "We added this aid to the selected bundles." context 'js_catalog' %} <span class="fas fa-thumbs-up"></span>',
        bookmark_error: '{{ _("Something went wrong. Please refresh the page.") }}',
    };
</script>
<script src="/static/js/aids/bookmark.js"></script>
{% endblock %}