{% extends '_base.html' %}
{% load i18n %}

{% block content %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li><a href="{% url 'home' %}">{{ _('Home') }}</a></li>
        <li class="active" aria-current="page">{{ _('All aids') }}</li>
    </ol>
</nav>

<section id="search">
    <div id="search-engine">
        <form action="" method="GET">
            {% include '_form_snippet.html' with form=form nest_field_class="field" %}
            <button type="submit">{{ _('Filter results') }}</button>
            <a class="reset" href="{% url 'search_view' %}">{{ _('Reset all filters') }}</a>
            <p>{% blocktrans %}
            As this is a beta service, some aids are yet to be referenced here.
            Feel free to contact us if you see that something is missing.
            {% endblocktrans %}</p>
        </form>
    </div>

    <div id="search-results">
        {% include 'aids/_results.html' %}
    </div>
</section>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/select2.scss" type="text/x-scss" charset="utf-8">
{% endblock %}

{% block extra_js %}
<script src="/static/jquery/dist/jquery.js"></script>
<script src="/static/select2/dist/js/select2.js"></script>
<script>
    $(document).ready(function() {
        $('select#id_perimeter').select2({
            placeholder: '{{ _('City, department, region, EPCIâ€¦') }}',
            ajax: {
                url: '{% url 'perimeters-list' %}',
                dataType: 'json',
                delay: 100,
            },
            theme: 'bootstrap4',
            width: '',
        });

        $('div#search-engine form').change(renderSearchResults);
    });

    var results_div = $('div#search-results');
    var results_url = '{% url 'results_view' %}';
    var renderSearchResults = function(event) {
        var $form = $(this);
        var search_parameters = $form.serialize();

        $.ajax({
            url: results_url,
            data: search_parameters,
            dataType: 'html',
        }).done(function(result) {
            results_div.html(result)
        });
    };
</script>
{% endblock %}
